/**
*author Chris Ludovice
*@date  11.26.2019
*description: utility class responsible for parsing service response to Apex objects.
@revision(s)
 */
public class Jsonparser{
    
   	public class JSON2Apex{
        public List<Data> data;
	}
    
    	public class Metadata {
        
        public V_status v_status;
            
		public String name;
		public String date_x;
				
        }
    	
        public class V_status {
		public Boolean revert;
		}
        
        public class Data{
            
            public Metadata metadata;
            
            public String code;
            public String requestId;
            public String campaignName;
            public String action;           
            public String createdAt;
            public String updatedAt;
        }

    public static JSON2Apex parse(String json) {
            return (JSON2Apex) System.JSON.deserialize(json, JSON2Apex.class);
        }       
   	public static void display(){
        
        // parse payload        
       String finalPayload= '{"data":[{"code":"pctpRqfBmstg","requestId":"e7b928aa-4101-4594-a350-983581b0197d","campaignName":"1 Million Voucher Percent Test","action":"PURCHASED","metadata":{"name":"test","date":"2019-10-07T09:22:17.386Z","v_status":{"revert":true}},"createdAt":"2019-10-07T09:22:17.386Z","updatedAt":"2019-10-07T09:22:17.386Z"}]}';        
       finalPayload=finalPayload.replace('"date":', '"date_x":'); // replace reserved word
        
        JSON2Apex  x = parse(finalPayload);
        List<Data> xx = x.Data;
        for(Data obj:xx){
            
            // print main node of json - > data
            system.debug('code:'+obj.code);
            system.debug('requestId:'+obj.requestId);
            system.debug('campaignName:'+obj.campaignName);
            system.debug('action:'+obj.action);
            system.debug('action:'+obj.createdAt);
            system.debug('action:'+obj.updatedAt);  
            
            // print 2nd node of json - > metadata
            system.debug('name:'+obj.metadata.name);
            system.debug('date:'+obj.metadata.date_x);
            
            // print 3nd node of json - > v_status
            system.debug('status:'+obj.metadata.v_status.revert);
 
            }

        }
   
}
